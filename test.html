<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas 转视频</title>
</head>
<body>
    <canvas id="myCanvas" width="640" height="480"></canvas>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        const stream = canvas.captureStream(30); // 每秒 30 帧
        const mediaRecorder = new MediaRecorder(stream);
        let chunks = [];

        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
                chunks.push(event.data);
            }
        };

        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'canvas_video.webm';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };

        mediaRecorder.start();

        function drawFrame(frame) {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'blue';
            ctx.fillRect(frame * 10, 100, 50, 50); // 示例：绘制一个移动的矩形
        }

        for (let frame = 0; frame < 60; frame++) {
            setTimeout(() => drawFrame(frame), frame * 100);
        }

        setTimeout(() => {
            mediaRecorder.stop(); // 停止录制
        }, 6000); // 录制时长
    </script>
</body>
</html>
